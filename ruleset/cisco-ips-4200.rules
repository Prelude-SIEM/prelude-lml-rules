#####
#
# Copyright (C) 2006 G Ramon Gomez <gene at gomezbrothers dot com>
# Ragingwire Enterprise Solutions (www.ragingwire.com)
# All Rights Reserved
#
# This file is part of the Prelude-LML program.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
#####

#####
#
# The rules included here were developed using a Cisco IPS module running on an
# ASA.  Please report any inconsistencies on other models to G Ramon Gomez at 
# the address provided above
# Special configuration is needed for this support:
# * In your IDM interface, "SNMP" -> "Traps Configuration", "Enable SNMP Traps"
#   box must be on.  "Enable detailed traps for alerts" can be on or off.
# * In your IDM interface, "Signature Definition" -> "Signature Configuration",
#   all of the ENABLED rules must be modified using the "Enabled" button, and
#   select all de enabled signatures followed by the "Actions" button, and 
#   click the "Request SNMP Trap" box on.
# * On your Prelude system, run snmptrapd using this command:
#   "snmptrapd -Ls 16 -Osq"
#
#####

#Apr 17 13:42:01 localhost snmptrapd[1209]: 2012-04-17 13:42:01 ids.xx.xx [UDP: [xx.xx.xx.xx]:xx->[xx.xx.xx.xx]]:#012iso.3.6.1.2.1.1.3.0 0:0:00:02.30#011iso.3.6.1.6.3.1.1.4.1.0 iso.3.6.1.4.1.9.9.383.0.2#011iso.3.6.1.4.1.9.9.383.1.1.1 1334191109271607011#011iso.3.6.1.4.1.9.9.383.1.1.2 "07 DC 04 11 0D 2A 01 00 "#011iso.3.6.1.4.1.9.9.383.1.1.3 "07 DC 04 11 10 2A 01 00 "#011iso.3.6.1.4.1.9.9.383.1.1.4 "xxx"#011iso.3.6.1.4.1.9.9.383.1.3.1 "xxx"#011iso.3.6.1.4.1.9.9.383.1.3.2 14#011iso.3.6.1.4.1.9.9.383.1.3.3 "Unknown control transaction name#012Messages, like this one, in the category - ct to sensorApp timed out - were logged 1 times in the last 0 seconds."

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.3.1 "(\S+)"+.+.9.9.383.1.3.2 "(\d+)"; \
 classification.text=$3; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 id=5000; \
 revision=0; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=high; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 additional_data(0).type=string; \
 additional_data(0).meaning=$3:; \
 additional_data(0).data=$4; \
 last


####################################
##Enable detailed traps for alerts##
####################################

#Apr 16 17:26:02 localhost snmptrapd[1209]: 2012-04-16 17:26:02 ids.xxx.xxx.com [UDP: [xx.xx.xx.xx]:xxxx->[xx.xx.xx.xx]:#012iso.3.6.1.2.1.1.3.0 4:23:47:30.17#011iso.3.6.1.6.3.1.1.4.1.0 iso.3.6.1.4.1.9.9.383.0.1#011iso.3.6.1.4.1.9.9.383.1.1.1 1334176696938219122#011iso.3.6.1.4.1.9.9.383.1.1.2 "07 DC 04 10 11 1A 02 00 "#011iso.3.6.1.4.1.9.9.383.1.1.3 "07 DC 04 10 14 1A 02 00 "#011iso.3.6.1.4.1.9.9.383.1.1.4 "ids-xxx"#011iso.3.6.1.4.1.9.9.383.1.2.1 "informational"#011iso.3.6.1.4.1.9.9.383.1.2.2 2147483648#011iso.3.6.1.4.1.9.9.383.1.2.3 "This Signature Is A Metacomponent"#011iso.3.6.1.4.1.9.9.383.1.2.4 "Windows Image Color Management System RCE"#011iso.3.6.1.4.1.9.9.383.1.2.5 6984#011iso.3.6.1.4.1.9.9.383.1.2.6 2#011iso.3.6.1.4.1.9.9.383.1.2.7 "S351"#011iso.3.6.1.4.1.9.9.383.1.2.12 0#011iso.3.6.1.4.1.9.9.383.1.2.13 80#011iso.3.6.1.4.1.9.9.383.1.2.14 "d3cucmFkaW9zaW50ZXJuZXQuY29tDQpWaWE6IDEuMSBzMTk2Y2I2NC5iYW5j#012by5icm91LmNvbS51eTo4MDgwIChJV1NTKSwgMS4xIHByb3h5LmRuc2ludC5i#012cm91LmNvbS51eSAoc3F1aWQpLCAxLjAgczE5NmNhNjE6ODAwOCAoSVdTUykN#012ClN1cnJvZ2F0ZS1DYXBhYmlsaXR5OiB1bnNldC1pZD0iU3Vycm9nYXRlLzEu#012MCBFU0kvMS4wIg0KWC1Gb3J3YXJkZWQtRm9yOiAxNzIuMjAuNDAuMjMNCkNh#012Y2hlLUNvbnRyb2w6IG1heC1hZ2U9MjU5MjAwDQoNCg=="#011iso.3.6.1.4.1.9.9.383.1.2.15 "EAASAAAAAAAAAGUAAAAAAACQRwAAQBIAAAAAAACI//8AAAAAAFD7/wBw/v8A#012AAAAALQAAAAAAAAAYOv/ADD7/wC4AAAAAAEA/y0AAAAAAQAAAAAAAAAAAAAM#012AAAAAAAAgAMAAAAHAAD6WV4AI5T+/yHj+/8AAAEAfZIAAKXkAADFxwEAAAAB#012AL6XAQCgrQEAAAABAOCbAQApAAAA/wAAAH0AAAD/AAAA/wAAAP8AAAD/AAAA#012/wAAAP8AAAD/AAAAkQAAABoAAAAZAAAAtQAAAN0AAACpAAAAEgAAACkAAAD/#012AAAAPQAAAAIAAAAQAAAAEgAAAAAAAAAAAGUAAAAAAA=="#011iso.3.6.1.4.1.9.9.383.1.2.16 "xx.xx.xx.xx:xx"#011iso.3.6.1.4.1.9.9.383.1.2.17 "osIdSource=\"unknown\" osRelevance=\"unknown\" osType=\"unknown\" xx.xx.xx.xx:xxx"#011iso.3.6.1.4.1.9.9.383.1.2.25 0#011iso.3.6.1.4.1.9.9.383.1.2.26 0#011iso.3.6.1.4.1.9.9.383.1.2.27 6#011iso.3.6.1.4.1.9.9.383.1.2.42 0

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.2.1 "(\S+)"+.+.9.9.383.1.2.4 "([\S ]+)"+.+.9.9.383.1.2.5 (\d+)+.+9.9.383.1.2.6 (\d+)+.+9.9.383.1.2.16 "([\d\.]+):(\d+)"+.+9.9.383.1.2.17 "osIdSource=\\"([\S ]+)\\" osRelevance=\\"([\S ]+)\\" osType=\\"([\S ]+)\\" ([\d\.]+)"; \
 classification.text=$4; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 classification.reference(0).name=$5.$6; \
 classification.reference(0).url=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 id=5001; \
 revision=1; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=$3; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$7; \
 source(0).service.port=$8; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$12; \
 target(0).service.port=$13; \
 additional_data(0).type=string; \
 additional_data(0).meaning=osIdSource:; \
 additional_data(0).data=$9; \
 additional_data(1).type=string; \
 additional_data(1).meaning=osRelevance:; \
 additional_data(1).data=$10; \
 additional_data(2).type=string; \
 additional_data(2).meaning=osType:; \
 additional_data(2).data=$11; \
 additional_data(3).type=string; \
 additional_data(3).meaning=Cisco Signature Template:; \
 additional_data(3).data=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 last

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.2.1 "informational"+.+.9.9.383.1.2.4 "([\S ]+)"+.+.9.9.383.1.2.5 (\d+)+.+9.9.383.1.2.6 (\d+)+.+9.9.383.1.2.16 "([\d\.]+):(\d+)"+.+9.9.383.1.2.17 "osIdSource=\\"([\S ]+)\\" osRelevance=\\"([\S ]+)\\" osType=\\"([\S ]+)\\" ([\d\.]+):(\d+)"; \
 classification.text=$3; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 classification.reference(0).name=$4.$5; \
 classification.reference(0).url=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$4&signatureSubId=$5; \
 id=5002; \
 revision=2; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=info; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$6; \
 source(0).service.port=$7; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$11; \
 target(0).service.port=$12; \
 additional_data(0).type=string; \
 additional_data(0).meaning=osIdSource:; \
 additional_data(0).data=$8; \
 additional_data(1).type=string; \
 additional_data(1).meaning=osRelevance:; \
 additional_data(1).data=$9; \
 additional_data(2).type=string; \
 additional_data(2).meaning=osType:; \
 additional_data(2).data=$10; \
 additional_data(3).type=string; \
 additional_data(3).meaning=Cisco Signature Template:; \
 additional_data(3).data=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$4&signatureSubId=$5; \
 last

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.2.1 "(\S+)"+.+.9.9.383.1.2.4 "([\S ]+)"+.+.9.9.383.1.2.5 (\d+)+.+9.9.383.1.2.6 (\d+)+.+9.9.383.1.2.16 "([\d\.]+):(\d+)"+.+9.9.383.1.2.17 "osIdSource=\\"([\S ]+)\\" osRelevance=\\"([\S ]+)\\" osType=\\"([\S ]+)\\" ([\d\.]+):(\d+)"; \
 classification.text=$4; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 classification.reference(0).name=$5.$6; \
 classification.reference(0).url=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 id=5002; \
 revision=1; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=$3; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$7; \
 source(0).service.port=$8; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$12; \
 target(0).service.port=$13; \
 additional_data(0).type=string; \
 additional_data(0).meaning=osIdSource:; \
 additional_data(0).data=$9; \
 additional_data(1).type=string; \
 additional_data(1).meaning=osRelevance:; \
 additional_data(1).data=$10; \
 additional_data(2).type=string; \
 additional_data(2).meaning=osType:; \
 additional_data(2).data=$11; \
 additional_data(3).type=string; \
 additional_data(3).meaning=Cisco Signature Template:; \
 additional_data(3).data=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 last


###############
##No Detailed##
###############

#Jan 25 12:41:14 localhost snmptrapd[15882]: 2012-01-25 12:41:14 ids.xxx.xxx.xxx [UDP: [xx.xx.xx.xx]:xxx->[xx.xx.xx.xx]]:#012iso.3.6.1.2.1.1.3.0 13:3:16:47.87#011iso.3.6.1.6.3.1.1.4.1.0 iso.3.6.1.4.1.9.9.383.0.1#011iso.3.6.1.4.1.9.9.383.1.1.1 1269399301253822810#011iso.3.6.1.4.1.9.9.383.1.1.2 "07 DC 01 19 0C 2A 27 00 "#011iso.3.6.1.4.1.9.9.383.1.1.3 "07 DC 01 19 0E 2A 27 00 "#011iso.3.6.1.4.1.9.9.383.1.1.4 "ids-xx"#011iso.3.6.1.4.1.9.9.383.1.2.1 "low"#011iso.3.6.1.4.1.9.9.383.1.2.2 2147483648#011iso.3.6.1.4.1.9.9.383.1.2.4 "TCP Option Other"#011iso.3.6.1.4.1.9.9.383.1.2.5 1306#011iso.3.6.1.4.1.9.9.383.1.2.6 0#011iso.3.6.1.4.1.9.9.383.1.2.16 "xx.xx.xx.xx:xxx"#011iso.3.6.1.4.1.9.9.383.1.2.17 "xx.xx.xx.xx:xx"

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.2.1 "(\S+)"+.+.9.9.383.1.2.4 "([\S ]+)"+.+.9.9.383.1.2.5 (\d+)+.+9.9.383.1.2.6 (\d+)+.+9.9.383.1.2.16 "([\d\.]+):(\d+)"+.+9.9.383.1.2.17 "+.+([\d\.]+)"; \
 classification.text=$4; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 classification.reference(0).name=$5.$6; \
 classification.reference(0).url=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 id=5003; \
 revision=1; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=$3; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$7; \
 source(0).service.port=$8; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$9; \
 target(0).service.port=$10; \
 additional_data(0).type=string; \
 additional_data(0).meaning=Cisco Signature Template:; \
 additional_data(0).data=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 last

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.2.1 "informational"+.+.9.9.383.1.2.4 "([\S ]+)"+.+.9.9.383.1.2.5 (\d+)+.+9.9.383.1.2.6 (\d+)+.+9.9.383.1.2.16 "([\d\.]+):(\d+)"+.+9.9.383.1.2.17 "+.+([\d\.]+):(\d+)"; \
 classification.text=$3; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 classification.reference(0).name=$4.$5; \
 classification.reference(0).url=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$4&signatureSubId=$5; \
 id=5004; \
 revision=2; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=info; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$6; \
 source(0).service.port=$7; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$8; \
 target(0).service.port=$9; \
 additional_data(0).type=string; \
 additional_data(0).meaning=Cisco Signature Template:; \
 additional_data(0).data=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$4&signatureSubId=$5; \
 last

regex=snmptrapd\[(\d+)]:+.+9.9.383.1.1.4 "(\S+)"+.+9.9.383.1.2.1 "(\S+)"+.+.9.9.383.1.2.4 "([\S ]+)"+.+.9.9.383.1.2.5 (\d+)+.+9.9.383.1.2.6 (\d+)+.+9.9.383.1.2.16 "([\d\.]+):(\d+)"+.+9.9.383.1.2.17 "+.+([\d\.]+):(\d+)"; \
 classification.text=$4; \
 classification.reference(0).origin=vendor-specific; \
 classification.reference(0).meaning=ips_id; \
 classification.reference(0).name=$5.$6; \
 classification.reference(0).url=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 id=5004; \
 revision=1; \
 analyzer(0).name=IPS; \
 analyzer(0).manufacturer=Cisco; \
 analyzer(0).class=IDS; \
 analyzer(0).node.name=$2; \
 assessment.impact.severity=$3; \
 assessment.impact.description=This event was generated by the Cisco IPS; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$7; \
 source(0).service.port=$8; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$9; \
 target(0).service.port=$10; \
 additional_data(0).type=string; \
 additional_data(0).meaning=Cisco Signature Template:; \
 additional_data(0).data=http://tools.cisco.com/security/center/viewIpsSignature.x?signatureId=$5&signatureSubId=$6; \
 last

